<html>
  <head>
    <link rel="stylesheet" href="/styles.css" />
    <script>

    document.addEventListener("DOMContentLoaded", () => {
    const dialog = document.getElementById("confirmDialog");
    const deleteBtn = document.getElementById("newImageDltBtn");
    const cancelBtn = document.getElementById("cancelBtn");
    const confirmBtn = document.getElementById("confirmBtn");
    const itemImage = document.getElementById("newItemImage");
    const fileInput = document.getElementById("newItemImageInput");
    const fileName = document.getElementById("fileName")

    const imageTypes = ["image/jpeg", "image/png", "image/webp", "image/gif"];
    const MAX_FILE_SIZE = 10485760;


    // Open dialog when delete icon clicked
    deleteBtn.addEventListener("click", () => {
      dialog.showModal();
    });

    // Close dialog
    cancelBtn.addEventListener("click", () => {
      dialog.close();
    });

    // Confirm delete
    confirmBtn.addEventListener("click", () => {
      dialog.close();
      itemImage.style.display = "none";
      fileName.textContent = '';
      

      if (deleteBtn) deleteBtn.style.display = "none";
      fileInput.style.display = "block"; // show file input
      fileInput.value = null; // Delete chosen file
    });

    fileInput.onchange = (e)=>{
      const [file] = fileInput.files;
      console.log({file},file.size  );
      if (file){
        if (imageTypes.includes(file.type)){
          itemImage.src = URL.createObjectURL(file);
        } else{
          itemImage.src = "/uploads/file.png";
          fileName.textContent = file.name;
        }
          itemImage.style.display = "block";
          deleteBtn.style.display = "flex"; // Show the delete icon
          fileInput.style.display = "none" // Hide the file input
        
        if (file.size > MAX_FILE_SIZE) {
          alert(`File size must be smaller than ${MAX_FILE_SIZE/(1024*1024)} MB`);
          fileInput.value = null;
          return; 
        }
      }
    }
  });


  function validateForm(event) {
    event.preventDefault();

    const fileInput = document.getElementById("newItemImageInput");
    console.log(fileInput.files);
    const file = fileInput.files[0];

    
    // ===== Item Image =====
    if (!file) {
      alert("Item image is required.");
      return;
    }

    if (file.size > MAX_FILE_SIZE) {
      alert(`Image must be smaller than ${MAX_FILE_SIZE/(1024*1024)} MB`);
      return;
    }


    document.getElementById("newFileForm").submit();
  }



    </script>
  </head>
  <body>
    <dialog id="confirmDialog">
      <h4>Are you sure you want to delete this file?</h4>
      <div class="dialogBtnWrapper">
        <button id="cancelBtn">Cancel</button>
        <button id="confirmBtn">Confirm</button>
      </div>
    </dialog>
    <%- include('header') %>
    <form
      id="newFileForm"
      method="post"
      action="/file/new"
      enctype="multipart/form-data"
      onsubmit="validateForm(event)"
    >
    <div class="inputContainer">
      <!-- <div class="labelInputWrapper">
        <label for="file_name">File Name</label>
        <input
          class="nameInput"
          type="text"
          id="file_name"
          name="file_name"
          placeholder="Enter File's name"
        />
      </div> -->

      <div class="labelInputWrapper">
        <label for="file_image">File</label>

        <div class="newItemImageWrapper">
          <img id="newItemImage" class="newitemImage" src="" alt="Item Image" />
         
          <div id="newImageDltBtn" class="newImageDltBtn">
            <img class="deleteBtn" src="https://cdn-icons-png.flaticon.com/512/6861/6861362.png" alt="Image Delete Button" /> 
          </div>
          <div id="fileName"></div>
        </div>

        <input
          class="newItemImageInput"
          type="file"
          id="newItemImageInput"
          name="file_image"
        />
      </div>

     


     
    </div>
    <div class="labelInputWrapper">

    <button class="submitBtn" type="submit">Submit</button>
    </div>

    </div>
    </form>
  </body>
</html>
